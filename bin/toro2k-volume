#!/bin/bash

amixer='amixer --mapped-volume'
mixer="Master"


print_volume() {
    local line="$($amixer sget $mixer | grep 'Mono:')"
    if echo $line | grep -q '\[off\]'; then
        # mixer is mute
        echo
    else
        echo $line | grep -o '[[:digit:]]\+%'
    fi
}


if [ $# -eq 0 ]; then
    print_volume
else
    case "$1" in
        '-u')
            $amixer -q sset $mixer '3%+' unmute
            ;;

        '-d')
            $amixer -q sset $mixer '3%-' unmute
            ;;

        '-t')
            $amixer -q sset $mixer toggle
            ;;

        *)
            printf "USAGE: %s up|down|toggle" "$0" 2>&1
            exit 1
            ;;
    esac

    pkill -RTMIN+1 i3blocks
fi

exit 0
