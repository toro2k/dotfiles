#!/bin/bash

amixer='amixer --mapped-volume'
mixer='Master'
step='3%'


print_volume() {
    local line="$($amixer sget $mixer | grep 'Mono:')"
    if grep -q '\[off\]' <<< "$line"; then
        printf '\n'
    else
        grep -o '[[:digit:]]\+%' <<< "$line"
        printf '\n'
        printf '#ffff00'
    fi
}


if [ $# -eq 0 ]; then
    print_volume
else
    case "$1" in
        'up')
            $amixer -q sset $mixer "${step}+" unmute
            ;;

        'down')
            $amixer -q sset $mixer "${step}-" unmute
            ;;

        'toggle')
            $amixer -q sset $mixer toggle
            ;;

        *)
            printf 'usage: %s [ up | down | toggle ]\n' "$0" 2>&1
            exit 1
            ;;
    esac

    pkill -RTMIN+1 i3blocks
fi

exit 0
