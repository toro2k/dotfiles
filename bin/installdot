#!/usr/bin/ruby -w

require 'pathname'

abort('USAGE: installdot [-f] DOTFILE') unless ARGV.last

force = ARGV.first == '-f'

home_dir = Pathname.new('~').expand_path
dotfile_name = Pathname.new(ARGV.last)

link_name = home_dir.join(dotfile_name)
target = home_dir.join('dotfiles', dotfile_name)

unless target.exist?
  abort("#{target} doen't exist")
end

if link_name.symlink? && link_name.readlink == target
  exit # Already installed, silently ignored.

elsif link_name.exist? || link_name.symlink? # may be a broken link
  if force
    link_name.delete
  else
    abort("#{link_name} already exists")
  end
end

link_name.make_symlink(target)
