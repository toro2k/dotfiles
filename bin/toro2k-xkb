#!/bin/bash

setxkbmap='/usr/bin/setxkbmap'

default_layout='us'
layouts=( us it )


current_layout() {
    $setxkbmap -query | awk '/layout:/ { print $2; }'
}

print_current_layout() {
    local current_layout=$(current_layout)
    if [ "$current_layout" = "$default_layout" ]; then
        printf '\n'
    else
        printf '%s\n' "$current_layout"
        printf '\n'
        printf '#ff0000'
    fi
}

next_layout() {
    local current_layout=$(current_layout)
    local next_layout_ix=0
    local i
    for (( i=0; i < ${#layouts[@]}; ++i )) {
        if [ "${layouts[$i]}" = "$current_layout" ]; then
            next_layout_ix=$(( ( $i + 1 ) % ${#layouts[@]} ))
            break
        fi
    }
    $setxkbmap "${layouts[$next_layout_ix]}"
}


if [ $# -eq 0 ]; then
    print_current_layout
elif [ "$1" = 'next' ]; then
    next_layout
    pkill -RTMIN+2 i3blocks
else
    printf 'usage: %s [ next ]\n' "$0" 2>&1
    exit 1
fi

exit 0
