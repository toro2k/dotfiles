scm_prompt() {
    if [ -x "$(which git 2> /dev/null)" ] && is_git_repo; then
        git_prompt
    elif [ -x "$(which svn 2> /dev/null)" ] && is_svn_repo; then
        svn_prompt
    fi
}

is_git_repo() {
    git branch &> /dev/null
}

git_prompt() {
    echo -n "git: $(git_cur_branch_name)"

    git_status=$(git status --porcelain)
    if [ -z "$git_status" ]; then
        echo -n ''
    elif echo "$git_status" | grep -q '^[MARCD]'; then
        echo -n ' (staged changes)'
    else
        echo -n ' (unstaged changes)'
    fi
}

# tail strips leading "* "
# tr removes parenthesis when HEAD is detached
git_cur_branch_name() {
    git branch | grep '^*' | tail -c+3 | tr -d '()'
}

is_svn_repo() {
    svn info &> /dev/null
}

svn_prompt() {
    echo -n 'svn: '
    if [ -z "$(svn status)" ]; then
        echo -n 'nothing to commit'
    else
        echo -n 'changes to commit'
    fi
}



PROMPT_DIRTRIM=3

ON_PURPLE='[45m'
YELLOW='[1;33m'
RESET_COLOR='[0m'

if [ -z $SSH_TTY ]; then
    PS1="\n${ON_PURPLE}[\w] \$(scm_prompt) ${RESET_COLOR}\n\$ "
else
    PS1='\n[\h] \w ${YELLOW}\$\$ ${RESET_COLOR}'
fi

PS2='> '

if [[ $TERM == 'xterm' || $TERM =~ 'rxvt' ]]; then
    if [ -z $SSH_TTY ]; then
        PROMPT_COMMAND='echo -ne "\033]0;${PWD}\007"'
    else
        PROMPT_COMMAND='echo -ne "\033]0;[${HOSTNAME}] ${PWD}\007"'
    fi
fi


