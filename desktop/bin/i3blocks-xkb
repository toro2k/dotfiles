#!/usr/bin/env python3

import subprocess
import sys


def read_current_layout():
    proc = subprocess.Popen(['setxkbmap', '-query'],
            stdout=subprocess.PIPE)
    for line in proc.stdout:
        if not line.startswith(b'layout:'):
            continue
        _, layout = line.split()
        return layout.decode()

def next_layout(layouts, current):
    current_index = layouts.index(current)
    next_index = (current_index + 1) % len(layouts)
    return layouts[next_index]

def set_next_layout(layouts, current):
    layout = next_layout(layouts, current)
    subprocess.call(['setxkbmap', layout])


layouts = ['us', 'it']
default_layout = 'us'
current_layout = read_current_layout()

if len(sys.argv) == 1:
    if not current_layout == default_layout:
        print(current_layout)
        print(current_layout)
        print('#ff0000')

elif sys.argv[1] == 'next':
    set_next_layout(layouts, current_layout)
    subprocess.call(['pkill', '-RTMIN+2', 'i3blocks'])

else:
    exit(1)

exit(0)
